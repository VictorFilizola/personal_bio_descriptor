private async Task FinishStep2()
        {
            errorMessage = null;
            if (vpDetails == null || managerAllocations == null || !IsSaveable())
            {
                errorMessage = "The total allocated value is different than the investment assigned to you. Please adjust the values.";
                return;
            }
            if (!int.TryParse(vpDetails.VersionID, out int versionId))
            {
                 errorMessage = "Invalid Version ID format.";
                 return;
            }

            try
            {
                await DirectorService.CompleteStep2Async(vpDetails.VpID, versionId, vpDetails.VpName ?? "", managerAllocations, EmailService, UserService, VersionService);
                NavigationManager.NavigateTo("/director/dashboard");
            }
            catch (Exception ex) // 'ex' is now used
            {
                // *** FIX: Log the exception ***
                Logger.LogError(ex, "Error completing Step 2 for VpId {VpId}", VpId);
                errorMessage = "An error occurred while saving the allocations. Please try again or contact support.";
            }
        }